"use strict";(self.webpackChunk_accounting_billing_stacklab=self.webpackChunk_accounting_billing_stacklab||[]).push([[571],{32869:function(e,t,n){n.d(t,{Ds:function(){return r.Ds}});var r=n(58518);n(58764)},36571:function(e,t,n){n.r(t),n.d(t,{default:function(){return ne}});var r=n(6907),a=n(93433),o=n(74165),i=n(15861),l=n(1413),s=n(29439),u=n(72791),c=n(89164),d=n(4567),p=n(57088),f=n(30439),m=n(71715),x=n(82626),h=n(48550),v=n(63466),Z=n(13400),y=n(36314),b=n(85771),g=n(64554),j=n(73590),P=n(89744),k=n(61889),C=n(49900),S=n(68096),w=n(50168),D=n(58406),A=n(5574),I=n(65661),M=n(39157),T=n(97123),N=n(42419),R=n(5403),B=n(97892),F=n.n(B),_=n(71652),z=n(24750),O=n(26759),E=n(43513),q=n(23937),W=n(27247),H=n(93704),U=n(18406),Y=n(52073),L=n(99615),V=n(32869),G=n(8976),$=n(80184),Q={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"75%",bgcolor:U.$_.modalbackground,borderRadius:"10px",height:"90%",overflowY:"auto",boxShadow:24,display:"flex",flexDirection:"column",justifyContent:"space-between",gap:"10px",p:2},K={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"400px",bgcolor:U.$_.modalbackground,borderRadius:"10px",height:"auto",boxShadow:24,p:2},J={customer:"",mobileNumber:"",salesMan:null,invoiceDate:null,invoiceDueDate:null,products:[],offer:"",amountToPay:"",totalAmount:0,productDiscount:0,paymentMode:"",paymentStatus:"",bank:""},X={category:"All Categories",product:null,quantity:"",netAmount:null,discount:null,sellingPrice:null},ee={salesOrderId:"",name:"",balance:0,amountToPay:0,paymentMode:"",bank:"",paymentDate:F()(new Date)};function te(){var e,t,n,r,B=(0,p.K$)(),te=(0,u.useRef)(null),ne=(0,G.E)().user,re=(0,u.useState)(0),ae=(0,s.Z)(re,2),oe=ae[0],ie=ae[1],le=(0,u.useState)(0),se=(0,s.Z)(le,2),ue=se[0],ce=se[1],de=(0,V.Ds)().enqueueSnackbar,pe=(0,u.useState)(!1),fe=(0,s.Z)(pe,2),me=fe[0],xe=fe[1],he=function(){Le(J),et(X),Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{customer:null})})),ie(0),ce(0)},ve=(0,u.useState)(!1),Ze=(0,s.Z)(ve,2),ye=Ze[0],be=Ze[1],ge=(0,u.useState)([]),je=(0,s.Z)(ge,2),Pe=je[0],ke=je[1],Ce=(0,u.useState)([]),Se=(0,s.Z)(Ce,2),we=Se[0],De=Se[1],Ae=(0,u.useState)([]),Ie=(0,s.Z)(Ae,2),Me=(Ie[0],Ie[1],(0,u.useState)([])),Te=(0,s.Z)(Me,2),Ne=Te[0],Re=Te[1],Be=(0,u.useState)([]),Fe=(0,s.Z)(Be,2),_e=Fe[0],ze=Fe[1],Oe=(0,u.useState)([]),Ee=(0,s.Z)(Oe,2),qe=Ee[0],We=Ee[1],He=(0,u.useState)(J),Ue=(0,s.Z)(He,2),Ye=Ue[0],Le=Ue[1],Ve=(0,u.useState)(""),Ge=(0,s.Z)(Ve,2),$e=Ge[0],Qe=Ge[1],Ke=(0,u.useState)(X),Je=(0,s.Z)(Ke,2),Xe=Je[0],et=Je[1],tt=(0,u.useState)(!1),nt=(0,s.Z)(tt,2),rt=nt[0],at=nt[1],ot=(0,u.useState)([]),it=(0,s.Z)(ot,2),lt=it[0],st=it[1],ut=(0,u.useState)([]),ct=(0,s.Z)(ut,2),dt=ct[0],pt=ct[1],ft=(0,u.useState)({totalSalesAmount:0,totalPaidAmount:0,pendingAmount:0}),mt=(0,s.Z)(ft,2),xt=mt[0],ht=mt[1],vt=(0,u.useState)(null),Zt=(0,s.Z)(vt,2),yt=Zt[0],bt=Zt[1],gt=Boolean(yt),jt=(0,u.useState)({}),Pt=(0,s.Z)(jt,2),kt=Pt[0],Ct=Pt[1],St=(0,u.useState)(!1),wt=(0,s.Z)(St,2),Dt=wt[0],At=wt[1],It=(0,u.useState)(ee),Mt=(0,s.Z)(It,2),Tt=Mt[0],Nt=Mt[1],Rt=(0,u.useState)(!1),Bt=(0,s.Z)(Rt,2),Ft=Bt[0],_t=Bt[1],zt=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.post(L.Hv.customer.list,{},{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&ke(r.data.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch customers!",{variant:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Ot=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.post(L.Hv.employee.list,{},{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&De(r.data.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch employees!",{variant:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Et=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.post(L.Hv.product.list,{},{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&ze(r.data.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch products!",{variant:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),qt=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.post(L.Hv.offer.list,{status:["LIVE"]},{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&We(r.data.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch offers!",{variant:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Wt=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.post(L.Hv.sales.list,{},{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&(at(!1),st(r.data.data),pt(r.data.data)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch sales orders!",{variant:"error"}),at(!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Ht=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.post(L.Hv.bank.list,{},{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&Re(r.data.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch bank accounts!",{variant:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Ut=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t),e.next=5,L.ZP.get(L.Hv.sales.summary,{headers:{Authorization:"Bearer ".concat(n)}});case 5:(r=e.sent)&&ht({totalSalesAmount:r.data.data.totalSalesAmount,totalPaidAmount:r.data.data.totalPaidAmount,pendingAmount:r.data.data.pendingAmount}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),de("Failed to fetch bank accounts!",{variant:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){at(!0),Wt(),Ut(),zt(),Ot(),Et(),qt(),Ht()}),[]);var Yt=[{name:"Customer Name",selector:function(e){return e.customerId.name},sortable:"true",width:"160px"},{name:"Sales Man Name",selector:function(e){return e.salesManId.name},sortable:"true",width:"160px"},{name:"Product Name",selector:function(e){return e.products.length>1?"".concat(e.products[0].name,", & ").concat(e.products.length-1," more"):e.products[0].name}},{name:"Amount",selector:function(e){return e.totalAmount.toFixed(2)},sortable:"true"},{name:"Payment Mode",selector:function(e){return e.payments[0].paymentID.paymentMode},sortable:"true"},{name:"Payment Status",selector:function(e){return e.paymentStatus},sortable:"true"},{name:"Invoice Number",selector:function(e){return e.invoiceNumber}},{name:"Voucher Amount",width:"120px",selector:function(e){return 0===e.discount.amount?"N/A":e.discount.amount.toFixed(2)}},{name:"Last Updated",width:"220px",selector:function(e){return(0,U.p6)(e.updatedAt)},sortable:"true"},{name:"Actions",width:"130px",cell:function(e){var t,n;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(f.Z,{disabled:!(null!==ne&&void 0!==ne&&null!==(t=ne.permissions)&&void 0!==t&&null!==(n=t.sales)&&void 0!==n&&n.u),onClick:function(t){bt(t.currentTarget),Ct(e)},style:{color:U.$_.actionButton},variant:"outlined",endIcon:(0,$.jsx)(O.Z,{}),children:"Action"}),(0,$.jsxs)(m.Z,{id:"basic-menu",anchorEl:yt,open:gt,onClose:function(){bt(null),Ct({})},MenuListProps:{"aria-labelledby":"basic-button"},children:[(0,$.jsx)(x.Z,{onClick:Vt,children:"Edit"}),(0,$.jsx)(x.Z,{onClick:function(){},children:"Send via Email"}),(0,$.jsx)(x.Z,{onClick:function(){},children:"Send via Whatsapp"}),(0,$.jsx)(x.Z,{onClick:function(){be(!0),bt(null)},children:"Delete"}),kt.remainingAmount>0&&(0,$.jsx)(x.Z,{onClick:function(){return bt(null),At(!0),Nt((function(e){return(0,l.Z)((0,l.Z)({},e),{},{name:kt.customerId.name,balance:kt.remainingAmount,salesOrderId:kt._id})})),void Ct({})},children:"Record Payment"})]})]})}}],Lt=function(e,t,n){"discount"===t&&(n<0?(n=0,de("Discount should be between 0 and 100 percent.",{variant:"error"})):n>100&&(n=100,de("Discount should be between 0 and 100 percent.",{variant:"error"}))),"quantity"===t&&n>Ye.products[e].product.quantity&&(n=Ye.products[e].product.quantity,de("There are only ".concat(Ye.products[e].product.quantity," units available."),{variant:"error"}));var r=(0,a.Z)(Ye.products),o=(0,l.Z)({},r[e]);o[t]=n,r[e]=o,console.log("new Product",r[e]),Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{products:r})}))},Vt=function(){bt(null),ie(kt.discount.amount),ce(kt.totalAmount-kt.remainingAmount);var e=kt.products.map((function(e){return{product:_e.find((function(t){return t.name===e.name})),quantity:e.quantity,sellingPrice:e.sellingPrice,discount:e.discount}}));console.log("\ud83d\ude80 ~ previousProducts ~ previousProducts:",e),Le((function(t){var n;return(0,l.Z)((0,l.Z)({},t),{},{customer:kt.customerId.name,mobileNumber:Pe.find((function(e){return e.mobileNumber===kt.customerId.mobileNumber})),salesMan:kt.salesManId,invoiceDate:F()(kt.invoiceDate),invoiceDueDate:F()(kt.invoiceDueDate),products:e,paymentMode:kt.payments[kt.payments.length-1].paymentID.paymentMode,paymentStatus:kt.paymentStatus},(null===kt||void 0===kt||null===(n=kt.discount)||void 0===n?void 0:n.offer)&&{offer:kt.discount.offer.id})})),_t(!0),xe(!0)},Gt=[{name:"Product Name",selector:function(e){var t,n;return null!==(t=null===e||void 0===e||null===(n=e.product)||void 0===n?void 0:n.name)&&void 0!==t?t:e.name}},{name:"Quantity",selector:function(e){return e.quantity},cell:function(e,t){return(0,$.jsx)(h.Z,{autoFocus:t===Ye.products.length-1,type:"number",onBlur:function(n){var r=(0,a.Z)(Ye.products),o=(0,l.Z)({},r[t]);(!e.quantity||parseInt(e.quantity,10)<=0)&&(de("Quantity cannot be empty",{variant:"error"}),o.quantity="1",r[t]=o,Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{products:r})})))},onChange:function(e){return Lt(t,"quantity",e.target.value)},value:e.quantity,size:"small"})},center:"true"},{name:"Sell Price",selector:function(e){return e.sellingPrice},cell:function(e,t){return(0,$.jsx)(h.Z,{type:"number",onBlur:function(){var n=(0,a.Z)(Ye.products),r=(0,l.Z)({},n[t]);(!e.sellingPrice||r.product.purchasePrice>parseInt(e.sellingPrice,10))&&(de("The product price cannot be lower than its purchase price of ".concat($t(Ye.products[t].product.purchasePrice)),{variant:"error"}),r.sellingPrice=String(r.product.purchasePrice),n[t]=r,Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{products:n})})))},onChange:function(e){return Lt(t,"sellingPrice",e.target.value)},value:e.sellingPrice,size:"small"})},center:"true"},{name:"GST Value",selector:function(e){var t,n;return null!==(t=null===e||void 0===e||null===(n=e.product)||void 0===n?void 0:n.gstValue)&&void 0!==t?t:e.gstValue},center:"true"},{name:"Discount",selector:function(e){return e.discount},cell:function(e,t){return(0,$.jsx)(h.Z,{value:e.discount,size:"small",disabled:!0,type:"number",onBlur:function(){if(0===e.discount.length){var n=(0,a.Z)(Ye.products),r=(0,l.Z)({},n[t]);r.discount="0",n[t]=r,Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{products:n})}))}},onChange:function(e){return Lt(t,"discount",e.target.value)},InputProps:{endAdornment:(0,$.jsx)(v.Z,{position:"end",children:(0,$.jsx)(H.Z,{fontSize:"small"})})}})},center:"true"},{name:"Net Amount",selector:function(e){return parseInt(e.quantity||0,10)*parseInt(e.sellingPrice||0,10)},center:"true"},{name:"Actions",cell:function(e,t){return(0,$.jsx)(Z.Z,{onClick:function(){return function(e,t){console.log("deleting product...",Ft),Ft&&Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{offer:{}})}));var n=(0,a.Z)(Ye.products);n.splice(t,1),Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{products:n})}))}(0,t)},color:"error",variant:"outlined",children:(0,$.jsx)(W.Z,{})})},center:"true"}],$t=new Intl.NumberFormat("hi-In",{style:"currency",currency:"INR"}).format;var Qt=Ye.products.reduce((function(e,t){var n=function(e){return parseInt(e.sellingPrice?e.sellingPrice:0,10)*parseInt(e.quantity?e.quantity:0,10)*(parseInt(e.discount?e.discount:0,10)/100)}(t);return e+n}),0),Kt=Ye.products.reduce((function(e,t){return e+parseInt(t.sellingPrice?t.sellingPrice:0,10)*parseInt(t.quantity?t.quantity:0,10)}),0),Jt=0;Object.keys(Ye.offer).length>0&&(Jt="PERCENTAGE"===Ye.offer.type?Kt*Ye.offer.typeValue/100:Ye.offer.typeValue);var Xt=Kt-(Qt+Number(Jt))-parseFloat(""!==oe?oe:0),en=0;Ye.amountToPay&&(en=Xt-Ye.amountToPay,Ft&&(en-=ue));var tn=(0,u.useState)(F()().startOf("month")),nn=(0,s.Z)(tn,2),rn=nn[0],an=nn[1],on=(0,u.useState)(F()().endOf("month")),ln=(0,s.Z)(on,2),sn=ln[0],un=ln[1];(0,u.useEffect)((function(){if(rn&&sn){var e=dt.filter((function(e){var t=F()(e.createdAt);return console.log(rn,sn),t.isBetween(rn,sn,null,"[]")}));st(e)}else st(dt)}),[rn,sn]);var cn=lt.filter((function(e){var t,n;return(null===e||void 0===e||null===(t=e.customerId.name)||void 0===t?void 0:t.toLowerCase().includes(null===$e||void 0===$e?void 0:$e.toLowerCase()))||(null===e||void 0===e||null===(n=e.invoiceNumber)||void 0===n?void 0:n.toLowerCase().includes(null===$e||void 0===$e?void 0:$e.toLowerCase()))}));return(0,$.jsxs)(c.Z,{maxWidth:!B.themeStretch&&"xl",children:[(0,$.jsx)(d.Z,{variant:"h4",children:" Sales "}),(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:"20px"},children:[(0,$.jsxs)(y.Z,{direction:"row",spacing:1,children:[(0,$.jsx)(b.Z,{label:"Total  ".concat(U.MG.format(xt.totalSalesAmount)),variant:"outlined"}),(0,$.jsx)(b.Z,{label:"Paid  ".concat(U.MG.format(xt.totalPaidAmount)),variant:"outlined"}),(0,$.jsx)(b.Z,{label:"Pending  ".concat(U.MG.format(xt.pendingAmount)),variant:"outlined"})]}),(null===ne||void 0===ne||null===(e=ne.permissions)||void 0===e||null===(t=e.sales)||void 0===t?void 0:t.u)&&(0,$.jsx)(y.Z,{children:(0,$.jsx)(f.Z,{variant:"contained",color:"primary",startIcon:(0,$.jsx)(N.Z,{}),onClick:function(){Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{invoiceDate:F()(new Date)})})),xe(!0),_t(!1)},children:"CREATE SALES ORDER"})})]}),(0,$.jsxs)("div",{style:{marginTop:"20px"},children:[(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[(0,$.jsx)("div",{children:(0,$.jsx)(h.Z,{placeholder:"Search",size:"small",value:$e,onChange:function(e){return Qe(e.target.value)},InputProps:{startAdornment:(0,$.jsx)(v.Z,{position:"start",children:(0,$.jsx)(R.Z,{})})}})}),(0,$.jsx)("div",{children:(0,$.jsx)(_._,{dateAdapter:z.y,children:(0,$.jsxs)(g.Z,{sx:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"center"},children:[(0,$.jsx)(q.M,{label:"From",format:"DD/MM/YYYY",value:rn,slotProps:{textField:{size:"small"}},onChange:function(e){an(e)},renderInput:function(e){return(0,$.jsx)(h.Z,(0,l.Z)({},e))}}),(0,$.jsx)(d.Z,{children:"-"}),(0,$.jsx)(q.M,{label:"To",format:"DD/MM/YYYY",value:sn,slotProps:{textField:{size:"small"}},onChange:function(e){un(e)},renderInput:function(e){return(0,$.jsx)(h.Z,(0,l.Z)({},e))}})]})})})]}),(0,$.jsx)("div",{style:{marginTop:"20px"},children:(0,$.jsx)(E.ZP,{columns:Yt,data:cn,pagination:!0,progressPending:rt})})]}),(0,$.jsx)(j.Z,{open:me,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,$.jsxs)(g.Z,{sx:Q,children:[(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",backgroundColor:"white",padding:"15px",borderRadius:"10px"},children:[(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"15px"},children:[(0,$.jsx)(P.Z,{disabled:Ft,value:Ye.mobileNumber,options:Pe,fullWidth:!0,getOptionLabel:function(e){return"string"===typeof e?e:e.mobileNumber},selectOnFocus:!0,onChange:function(e,t){console.log({newValue:t}),console.log("event calling and changing value from options"),Le(t?function(e){return(0,l.Z)((0,l.Z)({},e),{},{mobileNumber:t,customer:t.name})}:function(e){return(0,l.Z)((0,l.Z)({},e),{},{mobileNumber:null,customer:""})})},onInputChange:function(e,t){if(!Pe.some((function(e){return e.mobileNumber===t})))console.log("Mobile number new "),Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{mobileNumber:t,customer:""})}));else{var n=Pe.find((function(e){return e.mobileNumber===t}));Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{mobileNumber:t,customer:n.name})}))}},onBlur:function(e){var t=Ye.mobileNumber;"string"===typeof t&&(/^\d+$/.test(t)?Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{mobileNumber:t.slice(0,10)})})):(Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{mobileNumber:""})})),de("Mobile number must be numerical digits only!",{variant:"error"})))},freeSolo:!0,renderInput:function(e){return(0,$.jsx)(h.Z,(0,l.Z)((0,l.Z)({},e),{},{label:"Mobile Number",fullWidth:!0}))}}),(0,$.jsx)(h.Z,{label:"Customer Name",disabled:Ft,value:Ye.customer,onBlur:function(e){var t=Ye.customer;/\d/.test(t)&&(Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{customer:""})})),de("Customer name cannot contain digits!",{variant:"error"}))},fullWidth:!0,onChange:function(e){Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{customer:e.target.value})}))}})]}),(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"15px"},children:[(0,$.jsx)(P.Z,{value:Ye.salesMan,disabled:Ft,options:we,getOptionLabel:function(e){return e.name},fullWidth:!0,onChange:function(e,t){Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{salesMan:t})}))},renderInput:function(e){return(0,$.jsx)(h.Z,(0,l.Z)((0,l.Z)({},e),{},{label:"Sales Man",fullWidth:!0}))}}),(0,$.jsx)(_._,{dateAdapter:z.y,children:(0,$.jsx)(q.M,{label:"Invoice Date",value:Ye.invoiceDate,onChange:function(e){Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{invoiceDate:e})}))},format:"DD/MM/YYYY",disabled:Ft,slotProps:{textField:{fullWidth:!0}}})})]})]}),(0,$.jsx)(k.ZP,{container:!0,sx:{backgroundColor:"white",padding:"15px",borderRadius:"10px",display:"flex",justifyContent:"space-between"},alignItems:"center",children:(0,$.jsx)(k.ZP,{item:!0,xs:12,md:12,display:"flex",children:(0,$.jsx)(P.Z,{options:_e,getOptionLabel:function(e){return"".concat(e.name," (").concat(e.barcode.toString(),")")},value:null!==(n=null===Xe||void 0===Xe?void 0:Xe.product)&&void 0!==n?n:null,onChange:function(e,t){t?(et((function(e){return(0,l.Z)((0,l.Z)({},e),{},{product:t})})),function(e){if(Ye.products.find((function(t){return t.product.name===e.name})))de("Product already added!",{variant:"error"});else{var t=_e.find((function(t){return t.name===e.name}));if(t&&t.quantity<e.quantity)de("Product quantity not available!",{variant:"error"});else{var n={product:e,sellingPrice:e.sellingPrice,quantity:1,category:e.category,discount:0};Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{products:[].concat((0,a.Z)(e.products),[n])})})),console.log(e),et(X),te.current&&te.current.blur()}}}(t)):et((function(e){return(0,l.Z)((0,l.Z)({},e),{},{product:null})}))},fullWidth:!0,renderInput:function(e){return(0,$.jsx)(h.Z,(0,l.Z)((0,l.Z)({},e),{},{inputRef:te,label:"Search Products",fullWidth:!0}))}})})}),Ye.products.length>0&&(0,$.jsxs)(k.ZP,{container:!0,sx:{backgroundColor:"white",padding:"15px",borderRadius:"10px"},alignItems:"center",children:[(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(E.ZP,{columns:Gt,data:Ye.products})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,display:"flex",justifyContent:"flex-end",sx:{mt:2},children:(0,$.jsxs)("div",{style:{width:"200px"},children:[(0,$.jsx)("div",{children:"Voucher"}),(0,$.jsx)("div",{style:{paddingTop:"5px"},children:(0,$.jsx)(h.Z,{fullWidth:!0,size:"small",type:"number",label:"Enter Discount",disabled:Object.keys(Ye.offer).length>0,onBlur:function(e){""===oe&&ie(0),parseFloat(oe)>Kt&&(ie(),de("Discount cannot be greater than total amount!",{variant:"error"}))},value:oe,onChange:function(e){Object.keys(Ye.offer).length>0&&Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{offer:{}})})),ie(e.target.value)}})})]})}),(0,$.jsx)(C.Z,{primary:"OR",sx:{display:"flex",justifyContent:"flex-end",marginRight:"100px",mt:.5}}),console.log("sales.offer",Ye.offer),(0,$.jsx)(k.ZP,{item:!0,xs:12,display:"flex",justifyContent:"flex-end",sx:{mt:.5},children:(0,$.jsxs)("div",{style:{width:"200px"},children:[(0,$.jsx)("div",{children:"Select Offer"}),(0,$.jsx)("div",{style:{paddingTop:"5px"},children:Object.keys(null===Ye||void 0===Ye?void 0:Ye.offer).length>0?(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,$.jsx)(b.Z,{variant:"contained",color:"primary",label:"Offer Applied : ".concat(Ye.offer.code),onDelete:function(){Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{offer:{}})}))}}),(0,$.jsx)(d.Z,{variant:"caption",gutterBottom:!0,children:"PERCENTAGE"===Ye.offer.type?"".concat(Ye.offer.typeValue,"% Off"):"".concat($t(Ye.offer.typeValue)," Off")})]}):(0,$.jsx)("div",{style:{paddingTop:"5px"},children:(0,$.jsxs)(S.Z,{fullWidth:!0,size:"small",children:[(0,$.jsx)(w.Z,{id:"demo-simple-select-label",children:"Select Offer"}),(0,$.jsx)(D.Z,{disabled:oe,labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Select Offer",value:null!==(r=Ye.offer)&&void 0!==r?r:"",onChange:function(e){return Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{offer:e.target.value})}))},children:qe.map((function(e,t){return(0,$.jsx)(x.Z,{value:e,children:e.code},t)}))})]})})})]})})]}),(0,$.jsx)(k.ZP,{container:!0,display:"flex",justifyContent:"flex-end",children:(0,$.jsx)(k.ZP,{item:!0,xs:12,md:6,lg:6,sx:{backgroundColor:"white",padding:"15px",borderRadius:"10px"},children:(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,$.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,$.jsx)("div",{children:"Product Discount"}),(0,$.jsx)("div",{children:0===Ye.products.length?$t(0):$t(oe)})]}),0!==Object.keys(Ye.offer).length?(0,$.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,$.jsx)("div",{children:"Offer Discount"}),(0,$.jsx)("div",{children:$t(Jt)})]}):null,(0,$.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,$.jsx)("div",{children:"Total Amount"}),(0,$.jsx)("div",{children:0===Ye.products.length?$t(0):$t(Kt)})]})]})})}),(0,$.jsx)(k.ZP,{container:!0,display:"flex",justifyContent:"flex-end",children:(0,$.jsxs)(k.ZP,{item:!0,xs:12,md:6,lg:6,sx:{backgroundColor:"white",padding:"15px",borderRadius:"10px",display:"flex",flexDirection:"column",gap:"10px"},children:[(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"10px"},children:[(0,$.jsx)(h.Z,{fullWidth:!0,disabled:Ft,size:"small",type:"number",label:"Enter Amount",onBlur:function(e){console.log("totalAmount",Xt),parseFloat(Ye.amountToPay)>Xt&&(de("Amount to pay cannot be greater than total amount!",{variant:"error"}),Le((function(e){return(0,l.Z)((0,l.Z)({},e),{},{amountToPay:0})})))},value:Ye.amountToPay,onChange:function(e){Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{amountToPay:e.target.value})}))}}),(0,$.jsxs)(S.Z,{fullWidth:!0,size:"small",children:[(0,$.jsx)(w.Z,{id:"demo-simple-select-label",children:"Select Payment Status"}),(0,$.jsx)(D.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Select Payment Status",value:Ye.paymentStatus,disabled:Ft,onChange:function(e){return Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{paymentStatus:e.target.value})}))},children:U.y0.paymentStatus.map((function(e,t){return(0,$.jsx)(x.Z,{value:e,children:e},t)}))})]})]}),(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"10px"},children:[(0,$.jsxs)(S.Z,{fullWidth:!0,size:"small",children:[(0,$.jsx)(w.Z,{id:"demo-simple-select-label",children:"Select Payment Mode"}),(0,$.jsx)(D.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Select Payment Mode",value:Ye.paymentMode,disabled:Ft,onChange:function(e){return Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{paymentMode:e.target.value})}))},children:["CASH","CARD","UPI","CHEQUE"].map((function(e,t){return(0,$.jsx)(x.Z,{value:e,children:e},t)}))})]}),(0,$.jsxs)(S.Z,{fullWidth:!0,size:"small",children:[(0,$.jsx)(w.Z,{id:"demo-simple-select-label",children:"Select Bank"}),(0,$.jsx)(D.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Select Bank",value:Ye.bank,disabled:Ft||"CASH"===Ye.paymentMode,onChange:function(e){return Le((function(t){return(0,l.Z)((0,l.Z)({},t),{},{bank:e.target.value})}))},children:Ne.map((function(e,t){return(0,$.jsx)(x.Z,{value:e._id,children:e.bankName},t)}))})]})]})]})}),(0,$.jsx)(k.ZP,{container:!0,children:(0,$.jsxs)(k.ZP,{item:!0,xs:12,md:12,lg:12,sx:{backgroundColor:"white",p:"15px",borderRadius:"10px"},display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,$.jsxs)("div",{style:{display:"flex",justifyContent:"flex-start",gap:"20px"},children:[(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",gap:"40px"},children:[(0,$.jsx)("div",{children:"Total  :"}),(0,$.jsx)("div",{children:0===Ye.products.length?$t(0):$t(Xt)})]}),(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",gap:"40px"},children:[(0,$.jsx)("div",{children:"Balance  :"}),(0,$.jsx)("div",{children:0===Ye.products.length?$t(0):$t(en)})]}),Ft&&(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",gap:"40px"},children:[(0,$.jsx)("div",{children:"Previously Paid  :"}),(0,$.jsx)("div",{children:0===Ye.products.length?$t(0):$t(ue)})]})]}),(0,$.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[Ft?(0,$.jsx)(f.Z,{variant:"contained",onClick:function(){if(Xt<ue)de("Order Amount Must be greater than ".concat($t(ue),"!"),{variant:"error"});else{if(0!==en){if(""===Ye.amountToPay||0===parseFloat(Ye.amountToPay))return void de("Amount to pay cannot be empty or 0!.",{variant:"error"});if(parseFloat(Ye.amountToPay)>Xt-ue)return void de("Amount to pay cannot be greater than ".concat($t(Xt-ue),"!"),{variant:"error"})}console.log("sales.amountToPay",Ye.amountToPay);var e=(0,l.Z)({},Ye);e.discount={},e.discount.productDiscount=Qt,e.discount.amount=parseFloat(oe),Object.keys(Ye.offer).length>0&&(e.discount.offer={},e.discount.offer.discount=Jt,e.discount.offer.id=Ye.offer),e.products=Ye.products,e.balanceAmount=en,e.totalDiscount=Qt+Jt+parseFloat(oe),e.totalAmount=Xt,e.paymentStatus=Ye.paymentStatus,e.id=kt._id,delete e.offer,delete e.invoiceDueDate,delete e.salesMan,delete e.customer,delete e.invoiceDate,delete e.mobileNumber,console.log({updatePayload:e});var t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t);L.ZP.post(L.Hv.sales.update,e,{headers:{Authorization:"Bearer ".concat(n)}}).then((function(e){de("Sales order updated successfully!",{variant:"success"}),xe(!1),Ct({}),he(),Wt(),_t(!1),Ut()})).catch((function(e){de(e.error||e.err,{variant:"error"})}))}},color:"primary",disabled:!Ye.paymentStatus,children:"UPDATE"}):(0,$.jsx)(f.Z,{variant:"contained",onClick:function(){var e=(0,l.Z)({},Ye);if("string"===typeof Ye.mobileNumber&&Ye.mobileNumber.length<10)de("Mobile number must be 10 digits!",{variant:"error"});else if(Ye.customer.length<=1)de("Customer name must be greater than one alphabet!",{variant:"error"});else if(parseFloat(Ye.amountToPay)<=0)de("Amount to pay must be greater than 0!",{variant:"error"});else{e.discount={},e.discount.productDiscount=Qt,e.discount.amount=parseFloat(oe),Object.keys(Ye.offer).length>0&&(e.discount.offer={},e.discount.offer.discount=Jt,e.discount.offer.id=Ye.offer),e.totalDiscount=Qt+Jt+parseFloat(oe),e.totalAmount=Xt,console.log(e);var t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t);L.ZP.post(L.Hv.sales.add,e,{headers:{Authorization:"Bearer ".concat(n)}}).then((function(e){de("Sales order created successfully!",{variant:"success"}),xe(!1),he(),Wt(),Ut()})).catch((function(e){de(e.error||e.err,{variant:"error"})}))}},color:"primary",disabled:!Ye.customer||!Ye.mobileNumber||!Ye.salesMan||0===Ye.products.length||!Ye.amountToPay||!Ye.paymentMode||!Ye.paymentStatus||"CASH"!==Ye.paymentMode&&!Ye.bank,children:"SAVE"}),(0,$.jsx)(f.Z,{variant:"contained",color:"error",onClick:function(){xe(!1),_t(!1),he()},children:"CANCEL"})]})]})})]})}),(0,$.jsx)(j.Z,{id:"paymentModal",open:Dt,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,$.jsx)(g.Z,{sx:K,children:(0,$.jsxs)(k.ZP,{container:!0,sx:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(d.Z,{variant:"h6",children:"Customer Details"})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(h.Z,{label:"Name",value:Tt.name,disabled:!0,sx:{backgroundColor:"white",borderRadius:"7px"},fullWidth:!0})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(h.Z,{label:"Balance",value:Tt.balance,disabled:!0,sx:{backgroundColor:"white",borderRadius:"7px"},fullWidth:!0})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(d.Z,{variant:"h6",children:"Payment Details"})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(h.Z,{label:"Amount To Pay",value:Tt.amountToPay,onBlur:function(){Tt.amountToPay>Tt.balance&&(de("Amount to pay cannot be greater than balance!",{variant:"error"}),Nt((function(e){return(0,l.Z)((0,l.Z)({},e),{},{amountToPay:Tt.balance})})))},onChange:function(e){return Nt((function(t){return(0,l.Z)((0,l.Z)({},t),{},{amountToPay:e.target.value})}))},sx:{backgroundColor:"white",borderRadius:"7px"},fullWidth:!0})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsx)(_._,{dateAdapter:z.y,children:(0,$.jsx)(q.M,{label:"Payment Date",value:Tt.paymentDate,maxDate:F()(new Date),onChange:function(e){Nt((function(t){return(0,l.Z)((0,l.Z)({},t),{},{paymentDate:e})}))},sx:{backgroundColor:"white",borderRadius:"7px"},format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0}}})})}),(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsxs)(S.Z,{fullWidth:!0,children:[(0,$.jsx)(w.Z,{id:"record-payment-mode",children:"Select Payment Mode"}),(0,$.jsx)(D.Z,{labelId:"record-payment-mode",id:"demo-simple-select",label:"Select Payment Mode",sx:{backgroundColor:"white",borderRadius:"7px"},value:Tt.paymentMode,onChange:function(e){return Nt((function(t){return(0,l.Z)((0,l.Z)({},t),{},{paymentMode:e.target.value})}))},children:["CASH","CARD","UPI","CHEQUE"].map((function(e,t){return(0,$.jsx)(x.Z,{value:e,children:e},t)}))})]})}),"CASH"!==Tt.paymentMode&&(0,$.jsx)(k.ZP,{item:!0,xs:12,children:(0,$.jsxs)(S.Z,{fullWidth:!0,children:[(0,$.jsx)(w.Z,{id:"select-bank",children:"Select Bank"}),(0,$.jsx)(D.Z,{labelId:"select-bank",id:"demo-simple-select",label:"Select Bank",value:Tt.bank,sx:{backgroundColor:"white",borderRadius:"7px"},onChange:function(e){return Nt((function(t){return(0,l.Z)((0,l.Z)({},t),{},{bank:e.target.value})}))},children:Ne.map((function(e,t){return(0,$.jsx)(x.Z,{value:e._id,children:e.bankName},t)}))})]})}),(0,$.jsxs)(k.ZP,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[(0,$.jsx)(f.Z,{variant:"contained",color:"primary",onClick:function(){var e={};e.salesOrderId=Tt.salesOrderId,e.amountToPay=Tt.amountToPay,e.paymentDate=Tt.paymentDate,e.paymentMode=Tt.paymentMode,Tt.bank.length>0&&(e.bank=Tt.bank);var t=localStorage.getItem(Y._.keyUserToken),n=(0,U.sw)(t);L.ZP.post(L.Hv.sales.recordPayment,e,{headers:{Authorization:"Bearer ".concat(n)}}).then((function(e){de("Sales order payment recorded successfully!",{variant:"success"}),At(!1),Nt(ee),Wt(),Ut()})).catch((function(e){de(e.error,{variant:"error"})}))},disabled:!Tt.amountToPay||!Tt.paymentMode||"CASH"!==Tt.paymentMode&&!Tt.bank,children:"Update Payment"}),(0,$.jsx)(f.Z,{variant:"contained",color:"error",onClick:function(){At(!1),Nt(ee)},children:"Cancel"})]})]})})}),(0,$.jsxs)(A.Z,{open:ye,onClose:function(){return be(!1)},children:[(0,$.jsx)(I.Z,{children:"Remove"}),(0,$.jsx)(M.Z,{children:"Are you sure you want to delete this sales order?"}),(0,$.jsxs)(T.Z,{children:[(0,$.jsx)(f.Z,{onClick:function(){be(!1),Ct({})},children:"Cancel"}),(0,$.jsx)(f.Z,{onClick:function(){var e=localStorage.getItem(Y._.keyUserToken),t=(0,U.sw)(e),n={headers:{Authorization:"Bearer ".concat(t)}};L.ZP.post(L.Hv.sales.delete,{id:kt._id},n).then((function(e){e&&(de("Sales order deleted successfully!",{variant:"success"}),be(!1),Ct({}),Wt(),Ut())})).catch((function(e){console.log(e),de(e.msg||e.error,{variant:"error"})}))},variant:"contained",color:"error",children:"Delete"})]})]})]})}function ne(){return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(r.ql,{children:(0,$.jsx)("title",{children:" Dashboard : Sales"})}),(0,$.jsx)(te,{})]})}},27247:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),o=n(80184);t.Z=(0,a.default)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},93704:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),o=n(80184);t.Z=(0,a.default)((0,o.jsx)("path",{d:"M7.5 11C9.43 11 11 9.43 11 7.5S9.43 4 7.5 4 4 5.57 4 7.5 5.57 11 7.5 11m0-5C8.33 6 9 6.67 9 7.5S8.33 9 7.5 9 6 8.33 6 7.5 6.67 6 7.5 6M4.0025 18.5832 18.59 3.9955l1.4142 1.4143L5.4167 19.9974zM16.5 13c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5m0 5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"Percent")},65661:function(e,t,n){var r=n(87462),a=n(63366),o=n(72791),i=n(28182),l=n(94419),s=n(4567),u=n(66934),c=n(31402),d=n(17673),p=n(85090),f=n(80184),m=["className","id"],x=(0,u.ZP)(s.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:function(e,t){return t.root}})({padding:"16px 24px",flex:"0 0 auto"}),h=o.forwardRef((function(e,t){var n=(0,c.Z)({props:e,name:"MuiDialogTitle"}),s=n.className,u=n.id,h=(0,a.Z)(n,m),v=n,Z=function(e){var t=e.classes;return(0,l.Z)({root:["root"]},d.a,t)}(v),y=o.useContext(p.Z).titleId,b=void 0===y?u:y;return(0,f.jsx)(x,(0,r.Z)({component:"h2",className:(0,i.Z)(Z.root,s),ownerState:v,ref:t,variant:"h6",id:null!=u?u:b},h))}));t.Z=h}}]);
//# sourceMappingURL=571.d309f872.chunk.js.map